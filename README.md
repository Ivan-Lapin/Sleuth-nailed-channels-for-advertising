TG Ad Tracker PRO ‚Äì –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –±—Ä–µ–Ω–¥–æ–≤ –≤ Telegram
======================================================

–°–µ—Ä–≤–∏—Å –¥–ª—è –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞–¥–∞–Ω–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram‚Äë–∫–∞–Ω–∞–ª–∞—Ö, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞—ë—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ Telegram‚Äë–±–æ—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏ –ø–æ—Å—Ç–æ–≤.

–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
--------------------

- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ Telegram —á–µ—Ä–µ–∑ `SearchPostsRequest` (Telethon).  
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π (4 —Ç–∞–±–ª–∏—Ü—ã).  
- –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –±—Ä–µ–Ω–¥–∞ –≤ –∫–∞–∂–¥–æ–º –∫–∞–Ω–∞–ª–µ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (—É–ø–æ–º–∏–Ω–∞–Ω–∏–π > 2).  
- Telegram‚Äë–±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–∞–º–∏:
  - `/start` ‚Äì –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥.  
  - `/help` ‚Äì –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.  
  - `/stats` ‚Äì –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞–∑–µ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –±—Ä–µ–Ω–¥—É.  
  - `/detailed_stats_brand` ‚Äì –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ä–µ–∑ –ø–æ –±—Ä–µ–Ω–¥—É: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∏ –∏—Ö –ø–æ—Å—Ç—ã.  
  - `/detailed_stats_post` ‚Äì –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ Telegram API.  
  - `/today` ‚Äì –ø–æ—Å—Ç—ã, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è.  
- –ú–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
----------

- **Python 3.11+**  
- **Telethon** ‚Äì —Ä–∞–±–æ—Ç–∞ —Å Telegram API (–ø–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π).  
- **Aiogram 3** ‚Äì Telegram‚Äë–±–æ—Ç.  
- **SQLite + aiosqlite** ‚Äì –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.  
- **APScheduler** ‚Äì –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–µ–≥–∫–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è).  
- **prometheus‚Äëclient** ‚Äì —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ö–µ–º–∞ –ë–î
-----------------------

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 —Ç–∞–±–ª–∏—Ü—ã:

1. **Posts**

   - `ID_post` (TEXT, PK) ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Å—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `t.me/username/123` –∏–ª–∏ `t.me/c/<id>/<msg_id>`.  
   - `ID_channel` (INTEGER) ‚Äì ID –∫–∞–Ω–∞–ª–∞ –∏–∑ Telegram.  
   - `Brand_ID` (INTEGER) ‚Äì —Å—Å—ã–ª–∫–∞ –Ω–∞ `Brands.ID_brand`.  
   - `Date` (TEXT) ‚Äì –¥–∞—Ç–∞, –∫–æ–≥–¥–∞ –ø–æ—Å—Ç –Ω–∞–π–¥–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD`).  
   - `message_text` (TEXT) ‚Äì —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ (–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤).

2. **Channels**

   - `ID_channel` (INTEGER, PK) ‚Äì ID –∫–∞–Ω–∞–ª–∞.  
   - `name` (TEXT) ‚Äì –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞.  
   - `username` (TEXT) ‚Äì username –∫–∞–Ω–∞–ª–∞ –±–µ–∑ `@`.

3. **Brands**

   - `ID_brand` (INTEGER, PK, AUTOINCREMENT).  
   - `name` (TEXT, UNIQUE) ‚Äì –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞ (`FOREO`, `Bork`, –∏ —Ç.–¥.).

4. **Channels_Brands**

   - `ID_channel` (INTEGER).  
   - `ID_brand` (INTEGER).  
   - `mention_count` (INTEGER) ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –±—Ä–µ–Ω–¥–∞ –≤ –¥–∞–Ω–Ω–æ–º –∫–∞–Ω–∞–ª–µ.  
   - `PRIMARY KEY (ID_channel, ID_brand)`.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã:

- `idx_posts_channel` ‚Äì –ø–æ `Posts.ID_channel`.  
- `idx_posts_date` ‚Äì –ø–æ `Posts.Date`.  
- `idx_channels_brands` ‚Äì –ø–æ `(ID_channel, ID_brand)`.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
------------------

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
git clone <repo_url>
cd <repo_dir>

python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

–ï—Å–ª–∏ `requirements.txt` –Ω–µ—Ç, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é:

```bash
pip install telethon aiogram[fast] aiosqlite python-dotenv prometheus-client apscheduler
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
TELEGRAM_API_ID=12345678
TELEGRAM_API_HASH=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
BOT_TOKEN=1234567890:AAAAAAAA_BBBBBBBBBCCCCCCCCCC
```

- `TELEGRAM_API_ID` –∏ `TELEGRAM_API_HASH` ‚Äì –±–µ—Ä—É—Ç—Å—è —Å https://my.telegram.org.  
- `BOT_TOKEN` ‚Äì —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ @BotFather.

### 3. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
python main.py
```

–ü—Ä–æ–≥—Ä–∞–º–º–∞:

- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ë–î (`data/tg_global_ads.db`);  
- –ø–æ–¥–Ω–∏–º–∞–µ—Ç HTTP‚Äëendpoint –¥–ª—è –º–µ—Ç—Ä–∏–∫ –Ω–∞ `http://localhost:8000/metrics`;  
- –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram;  
- –∑–∞–ø—É—Å–∫–∞–µ—Ç Telegram‚Äë–±–æ—Ç–∞;  
- –æ—Å—Ç–∞—ë—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –Ω–∞–∂–∞—Ç–∏—è `Ctrl+C` (graceful shutdown).

–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –±—Ä–µ–Ω–¥–æ–≤
------------------------

–ü–æ–∏—Å–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
async def global_brand_search(client, brand): ...
```

- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telethon `SearchPostsRequest` –ø–æ —Ç–µ–∫—Å—Ç—É –±—Ä–µ–Ω–¥–∞;  
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –ë–î —á–µ—Ä–µ–∑ `save_channel_mention`;  
- –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫ `mention_count` –≤ `Channels_Brands`;  
- —É—á–∏—Ç—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (—á–µ—Ä–µ–∑ `CheckSearchPostsFloodRequest`, —Å fallback, –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω).

–°–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ –∑–∞–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ:

```python
BRANDS = ["FOREO", "Bork", "Remez", "Dreame", "L&L Skin", "D'alba", "NFO"]
```

–ï–≥–æ –º–æ–∂–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å.

Telegram‚Äë–±–æ—Ç: –∫–æ–º–∞–Ω–¥—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
--------------------------------

### `/start`

–ö—Ä–∞—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥. –ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å –ë–î –Ω–µ –¥–µ–ª–∞–µ—Ç.

–ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞:

- –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞.  
- –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á (–ø–æ–∏—Å–∫ –±—Ä–µ–Ω–¥–æ–≤, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–æ–≤).  
- –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥: `/help`, `/stats`, `/detailed_stats_brand`, `/detailed_stats_post`, `/today`.

### `/help`

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–∏—Å: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –∏ –ø–æ—Å—Ç–æ–≤.  
- –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–∞–Ω–∞–ª¬ª (—É–ø–æ–º–∏–Ω–∞–Ω–∏–π –±—Ä–µ–Ω–¥–∞ > 2).  
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –∏ —á—Ç–æ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.  
- –§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞ –¥–ª—è `/detailed_stats_post`.

### `/stats`

1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –ø–æ –±–∞–∑–µ:

   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤;  
   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–µ–Ω–¥–æ–≤;  
   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤ (—Å–µ–π—á–∞—Å: –∑–∞ —Å–µ–≥–æ–¥–Ω—è, –ª–∏–±–æ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞);  
   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–≥–¥–µ `mention_count > 2`).

2. –ü–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º ‚Äì –∏–Ω–ª–∞–π–Ω‚Äë–∫–Ω–æ–ø–∫–∏ —Å –±—Ä–µ–Ω–¥–∞–º–∏.  

3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –±—Ä–µ–Ω–¥–∞ (`statsbrand_<brand>`) –±–æ—Ç:

   - —Å—á–∏—Ç–∞–µ—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞:
     - —á–∏—Å–ª–æ –∫–∞–Ω–∞–ª–æ–≤, –≥–¥–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –±—Ä–µ–Ω–¥;  
     - —á–∏—Å–ª–æ –ø–æ—Å—Ç–æ–≤ —Å –±—Ä–µ–Ω–¥–æ–º;  
     - —á–∏—Å–ª–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å —ç—Ç–∏–º –±—Ä–µ–Ω–¥–æ–º;  
   - –≤—ã–≤–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ —ç—Ç—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –±—Ä–µ–Ω–¥—É.  
   - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ –¥–µ–ª–∞–µ—Ç** (–Ω–∏–∫–∞–∫–∏—Ö –ø–æ—Å—Ç–æ–≤/–∫–Ω–æ–ø–æ–∫).

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥—É —Å—Ç—Ä–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ `get_brand_aggregate_stats`.

### `/detailed_stats_brand`

1. –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å –±—Ä–µ–Ω–¥ (–∫–Ω–æ–ø–∫–∏ –±—Ä–µ–Ω–¥–æ–≤).  
2. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ (`detbrand_<brand>`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:

   - –≤—ã–±–æ—Ä –≤—Å–µ—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –±—Ä–µ–Ω–¥–∞ (`mention_count > 2`);  
   - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞ ‚Äì –≤—ã–±–æ—Ä –¥–æ 10 –ø–æ—Å—Ç–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ **–æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º**;  
   - —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:

     ```
     üìä –ü–û–î–†–û–ë–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –ë–†–ï–ù–î–£ Bork:

     1) @username ‚Äî –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ (xN)
        ‚Ä¢ DD.MM.YYYY | ID: t.me/username/123 | –ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤‚Ä¶
        ‚Ä¢ ...
     2) @another_channel ‚Äî –ù–∞–∑–≤–∞–Ω–∏–µ (xM)
        ‚Ä¢ ...
     ```

   - –Ω–∏–∫–∞–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ (–∫–Ω–æ–ø–æ–∫, TGStat –∏ —Ç.–ø.) –∑–¥–µ—Å—å –Ω–µ—Ç ‚Äì —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç.

–î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è —á–µ—Ä–µ–∑ `get_detailed_brand_channels`.

### `/detailed_stats_post`

1. –ë–æ—Ç –ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:

   ```text
   @channel_username 12345
   ```

2. –°–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Ç—á–∏—Ç —Ä–µ–≥—É–ª—è—Ä–∫—É `^@[\w\d_]+\s+\d+$`.  
3. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç:

   - `username` ‚Äì –Ω–∏–∫ –∫–∞–Ω–∞–ª–∞ –±–µ–∑ `@`;  
   - `message_id` ‚Äì ID –ø–æ—Å—Ç–∞.

4. –í—ã–∑—ã–≤–∞–µ—Ç `get_post_stats_via_telegram(username, message_id)` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

   - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã;  
   - –ø–µ—Ä–µ—Å—ã–ª–∫–∏;  
   - —Ä–µ–∞–∫—Ü–∏–∏ (–ø–æ –∫–∞–∂–¥–æ–º—É —ç–º–æ–¥–∑–∏);  
   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤;  
   - –¥–ª–∏–Ω–∞ –∏ –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞;  
   - –¥–∞—Ç–∞ (`dd.mm.yyyy`);  
   - –≤—Ä–µ–º—è (`hh:mm`);  
   - –≤–æ–∑—Ä–∞—Å—Ç –ø–æ—Å—Ç–∞ –≤ —á–∞—Å–∞—Ö.

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ—Ä—ë—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Telegram, –±–µ–∑ TGStat.

### `/today`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å—Ç–æ–≤, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è:

- –¥–∞—Ç–∞ –ø–æ–∏—Å–∫–∞;  
- username –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞;  
- –±—Ä–µ–Ω–¥;  
- —Å—Å—ã–ª–∫–∞ `t.me/.../id_post` (ID_post —Ö—Ä–∞–Ω–∏—Ç—Å—è —É–∂–µ –≤ —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ).

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
--------------------

–°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ Prometheus:

- `tg_search_requests_total{brand,status}` ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –±—Ä–µ–Ω–¥—É –∏ —Å—Ç–∞—Ç—É—Å—É (`start`, `success`, `error`).  
- `tg_remaining_searches` ‚Äì –æ—Ü–µ–Ω–∫–∞ –æ—Å—Ç–∞—Ç–∫–∞ –ª–∏–º–∏—Ç–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.  
- `tg_total_mentions{brand}` ‚Äì —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–µ–Ω–¥–∞.  
- `tg_relevant_channels_total{brand}` ‚Äì –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏).

–ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É:

```text
http://localhost:8000/metrics
```

–ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Prometheus –∏ Grafana –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤.

Graceful shutdown
-----------------

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º `SIGINT`/`SIGTERM` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ `Ctrl+C`):

- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `shutdown_event`, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Å–∏–≥–Ω–∞–ª–∞;  
- `start_bot` —Å–ª—É—à–∞–µ—Ç —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∏ –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É polling aiogram;  
- `main` –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –±–æ—Ç–∞ –∏ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ `TelegramClient`;  
- —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–ü—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∑–∞–º–µ—Ç–∫–∏
-----------------

- –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ISO‚Äë—Ñ–æ—Ä–º–∞—Ç (`YYYY-MM-DD`) –≤ –ë–î –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ.  
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ `/detailed_stats_post` –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω `TelegramClient`, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.  
- –õ–æ–≥–∏ –ª—É—á—à–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ —Ñ–∞–π–ª –∏–ª–∏ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (loguru, structlog, Sentry –∏ —Ç.–ø.), –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ.  
- –î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º –º–æ–∂–Ω–æ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å `APScheduler` –∏ cron‚Äë–∑–∞–¥–∞—á–∏ –≤–Ω—É—Ç—Ä–∏ `main()`.

–ö–∞–∫ —Ä–∞—Å—à–∏—Ä—è—Ç—å
-------------

–ò–¥–µ–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è:

- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —è–∑—ã–∫—É –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω—É –∫–∞–Ω–∞–ª–æ–≤.  
- –í–≤–µ—Å—Ç–∏ –≤–µ—Å–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º (–±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏).  
- –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±‚Äë–ø–∞–Ω–µ–ª—å (FastAPI) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–π –∂–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.  
- –°–æ–±—Ä–∞—Ç—å Docker‚Äë–æ–±—Ä–∞–∑ –∏ docker‚Äëcompose —Å Prometheus –∏ Grafana.